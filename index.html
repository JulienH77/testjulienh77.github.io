<!DOCTYPE html>
<html>
<head>
    <title>Carte avec trajets animés</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Assure-toi que leaflet.motion.min.js est bien chargé -->
    <script src="leaflet.motion.min.js"></script>
    <style>
        #map { height: 600px; margin-bottom: 10px; }
        button { margin: 5px; padding: 8px 12px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="map"></div>
    <button id="showAll">Afficher tous les trajets</button>
    <button id="startAnimation">Animer "May 2025 - China"</button>

    <script>
        // Initialisation de la carte avec OSM
        const map = L.map('map').setView([30, 105], 4);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Couleurs par type de transport
        const colorByTrajet = {
            'avion': '#FF0000',
            'train': '#00FF00',
            'bateau': '#0000FF',
            // Ajoute d'autres types si nécessaire
        };

        // Variable globale pour stocker le GeoJSON chargé
        let geojsonData;
        // Variable pour stocker les couches GeoJSON
        let allLayers = L.featureGroup().addTo(map);
        let chinaLayers = L.featureGroup();

        // Chargement du GeoJSON externe
        fetch('TRAJETS_ALL_vacances_wgs.geojson')
            .then(response => response.json())
            .then(data => {
                console.log("GeoJSON chargé:", data);
                geojsonData = data; // Stocke les données dans la variable globale
                showAllTrajectories(geojsonData);
            })
            .catch(error => console.error("Erreur de chargement du GeoJSON:", error));

        // Fonction pour afficher tous les trajets
        function showAllTrajectories(geojson) {
            allLayers.clearLayers();
            L.geoJSON(geojson, {
                style: function(feature) {
                    return {
                        color: colorByTrajet[feature.properties.trajet] || '#808080',
                        weight: 3,
                        opacity: 0.7
                    };
                }
            }).addTo(allLayers);
        }

        // Fonction pour afficher et animer uniquement "May 2025 - China"
        function animateChinaTrajectories() {
            if (!geojsonData) {
                alert("Le GeoJSON n'est pas encore chargé.");
                return;
            }

            allLayers.clearLayers();
            chinaLayers.clearLayers();

            const chinaTrajectories = geojsonData.features.filter(
                feature => feature.properties.voyage === "May 2025 - China"
            );

            if (typeof L.Motion === 'undefined') {
                alert("La bibliothèque leaflet.motion n'est pas chargée. Vérifie le chemin vers leaflet.motion.min.js.");
                return;
            }

            chinaTrajectories.forEach(feature => {
                if (feature.geometry.type === 'LineString') {
                    const latlngs = feature.geometry.coordinates.map(coord => L.latLng(coord[1], coord[0]));
                    const motion = L.Motion.polyline(
                        latlngs,
                        { color: colorByTrajet[feature.properties.trajet] || '#808080' },
                        { duration: 10000, easing: L.Motion.Ease.linear }
                    ).addTo(map);
                    motion.start();
                }
            });
        }

        // Écouteurs d'événements pour les boutons
        document.getElementById('showAll').addEventListener('click', () => showAllTrajectories(geojsonData));
        document.getElementById('startAnimation').addEventListener('click', animateChinaTrajectories);
    </script>
</body>
</html>
